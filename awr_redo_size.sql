col redo_mb format 99999990.99
select
	 TO_CHAR(C.BEGIN_INTERVAL_TIME,'YYYY-MM-DD HH24:MI') BEGIN_INTERVAL_TIME
	,(B.value - A.value)/1024/1024 redo_mb
FROM
	DBA_HIST_SYSSTAT A, 
	DBA_HIST_SYSSTAT B,
	DBA_HIST_SNAPSHOT C
WHERE 
	    B.SNAP_ID = A.SNAP_ID+1
	AND B.STAT_NAME = A.STAT_NAME
	AND B.INSTANCE_NUMBER = A.INSTANCE_NUMBER
	AND B.SNAP_ID=C.SNAP_ID 
	AND B.INSTANCE_NUMBER = C.INSTANCE_NUMBER
	AND B.STAT_NAME='redo size'
	AND C.BEGIN_INTERVAL_TIME > systimestamp - 7
ORDER BY
	C.BEGIN_INTERVAL_TIME
;


col redo_mb format 99999999
select
	 TO_CHAR(C.BEGIN_INTERVAL_TIME,'YYYY-MM-DD HH24') BEGIN_INTERVAL_TIME
	,SUM((B.value - A.value)/1024/1024) redo_mb
FROM
	DBA_HIST_SYSSTAT A, 
	DBA_HIST_SYSSTAT B,
	DBA_HIST_SNAPSHOT C
WHERE 
	    B.SNAP_ID = A.SNAP_ID+1
	AND B.STAT_NAME = A.STAT_NAME
	AND B.INSTANCE_NUMBER = A.INSTANCE_NUMBER
	AND B.SNAP_ID=C.SNAP_ID 
	AND B.INSTANCE_NUMBER = C.INSTANCE_NUMBER
	AND B.STAT_NAME='redo size'
	AND C.BEGIN_INTERVAL_TIME > systimestamp - 7
GROUP BY
	TO_CHAR(C.BEGIN_INTERVAL_TIME,'YYYY-MM-DD HH24')
ORDER BY
	1
;

SET NUMFORMAT 999999 LIN 400 PAGES 200
SELECT
	 TO_CHAR(C.BEGIN_INTERVAL_TIME,'YYYY-MM-DD') "DATE"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'00',((B.VALUE - A.VALUE)/1024/1024)))/60 "00"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'01',((B.VALUE - A.VALUE)/1024/1024)))/60 "01"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'02',((B.VALUE - A.VALUE)/1024/1024)))/60 "02"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'03',((B.VALUE - A.VALUE)/1024/1024)))/60 "03"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'04',((B.VALUE - A.VALUE)/1024/1024)))/60 "04"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'05',((B.VALUE - A.VALUE)/1024/1024)))/60 "05"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'06',((B.VALUE - A.VALUE)/1024/1024)))/60 "06"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'07',((B.VALUE - A.VALUE)/1024/1024)))/60 "07"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'08',((B.VALUE - A.VALUE)/1024/1024)))/60 "08"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'09',((B.VALUE - A.VALUE)/1024/1024)))/60 "09"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'10',((B.VALUE - A.VALUE)/1024/1024)))/60 "10"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'11',((B.VALUE - A.VALUE)/1024/1024)))/60 "11"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'12',((B.VALUE - A.VALUE)/1024/1024)))/60 "12"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'13',((B.VALUE - A.VALUE)/1024/1024)))/60 "13"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'14',((B.VALUE - A.VALUE)/1024/1024)))/60 "14"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'15',((B.VALUE - A.VALUE)/1024/1024)))/60 "15"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'16',((B.VALUE - A.VALUE)/1024/1024)))/60 "16"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'17',((B.VALUE - A.VALUE)/1024/1024)))/60 "17"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'18',((B.VALUE - A.VALUE)/1024/1024)))/60 "18"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'19',((B.VALUE - A.VALUE)/1024/1024)))/60 "19"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'20',((B.VALUE - A.VALUE)/1024/1024)))/60 "20"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'21',((B.VALUE - A.VALUE)/1024/1024)))/60 "21"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'22',((B.VALUE - A.VALUE)/1024/1024)))/60 "22"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'23',((B.VALUE - A.VALUE)/1024/1024)))/60 "23"
FROM
	DBA_HIST_SYSSTAT A, 
	DBA_HIST_SYSSTAT B,
	DBA_HIST_SNAPSHOT C
WHERE 
	    B.SNAP_ID = A.SNAP_ID+1
	AND B.STAT_NAME = A.STAT_NAME
	AND B.INSTANCE_NUMBER = A.INSTANCE_NUMBER
	AND B.SNAP_ID=C.SNAP_ID 
	AND B.INSTANCE_NUMBER = C.INSTANCE_NUMBER
	AND B.STAT_NAME='redo size'
GROUP BY
	TO_CHAR(C.BEGIN_INTERVAL_TIME,'YYYY-MM-DD')
ORDER BY
	1
;


set numformat 999999 lin 400 pages 200
SELECT
	 TO_CHAR(C.BEGIN_INTERVAL_TIME,'YYYY-MM-DD') "DATE"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'00',B.TOTAL_MESSAGES_CAPTURED - A.TOTAL_MESSAGES_CAPTURED))/60 "00"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'01',B.TOTAL_MESSAGES_CAPTURED - A.TOTAL_MESSAGES_CAPTURED))/60 "01"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'02',B.TOTAL_MESSAGES_CAPTURED - A.TOTAL_MESSAGES_CAPTURED))/60 "02"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'03',B.TOTAL_MESSAGES_CAPTURED - A.TOTAL_MESSAGES_CAPTURED))/60 "03"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'04',B.TOTAL_MESSAGES_CAPTURED - A.TOTAL_MESSAGES_CAPTURED))/60 "04"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'05',B.TOTAL_MESSAGES_CAPTURED - A.TOTAL_MESSAGES_CAPTURED))/60 "05"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'06',B.TOTAL_MESSAGES_CAPTURED - A.TOTAL_MESSAGES_CAPTURED))/60 "06"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'07',B.TOTAL_MESSAGES_CAPTURED - A.TOTAL_MESSAGES_CAPTURED))/60 "07"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'08',B.TOTAL_MESSAGES_CAPTURED - A.TOTAL_MESSAGES_CAPTURED))/60 "08"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'09',B.TOTAL_MESSAGES_CAPTURED - A.TOTAL_MESSAGES_CAPTURED))/60 "09"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'10',B.TOTAL_MESSAGES_CAPTURED - A.TOTAL_MESSAGES_CAPTURED))/60 "10"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'11',B.TOTAL_MESSAGES_CAPTURED - A.TOTAL_MESSAGES_CAPTURED))/60 "11"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'12',B.TOTAL_MESSAGES_CAPTURED - A.TOTAL_MESSAGES_CAPTURED))/60 "12"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'13',B.TOTAL_MESSAGES_CAPTURED - A.TOTAL_MESSAGES_CAPTURED))/60 "13"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'14',B.TOTAL_MESSAGES_CAPTURED - A.TOTAL_MESSAGES_CAPTURED))/60 "14"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'15',B.TOTAL_MESSAGES_CAPTURED - A.TOTAL_MESSAGES_CAPTURED))/60 "15"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'16',B.TOTAL_MESSAGES_CAPTURED - A.TOTAL_MESSAGES_CAPTURED))/60 "16"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'17',B.TOTAL_MESSAGES_CAPTURED - A.TOTAL_MESSAGES_CAPTURED))/60 "17"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'18',B.TOTAL_MESSAGES_CAPTURED - A.TOTAL_MESSAGES_CAPTURED))/60 "18"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'19',B.TOTAL_MESSAGES_CAPTURED - A.TOTAL_MESSAGES_CAPTURED))/60 "19"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'20',B.TOTAL_MESSAGES_CAPTURED - A.TOTAL_MESSAGES_CAPTURED))/60 "20"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'21',B.TOTAL_MESSAGES_CAPTURED - A.TOTAL_MESSAGES_CAPTURED))/60 "21"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'22',B.TOTAL_MESSAGES_CAPTURED - A.TOTAL_MESSAGES_CAPTURED))/60 "22"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'23',B.TOTAL_MESSAGES_CAPTURED - A.TOTAL_MESSAGES_CAPTURED))/60 "23"
FROM
	DBA_HIST_STREAMS_CAPTURE A, 
	DBA_HIST_STREAMS_CAPTURE B,
	DBA_HIST_SNAPSHOT C
WHERE 
	    B.SNAP_ID = A.SNAP_ID+1
	AND B.INSTANCE_NUMBER = A.INSTANCE_NUMBER
	AND B.SNAP_ID=C.SNAP_ID 
	AND B.INSTANCE_NUMBER = C.INSTANCE_NUMBER
GROUP BY
	TO_CHAR(C.BEGIN_INTERVAL_TIME,'YYYY-MM-DD')
ORDER BY
	1
;


for i in {10..23}; do
  echo ",SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'$i',B.TOTAL_MESSAGES_CAPTURED - A.TOTAL_MESSAGES_CAPTURED))/60/60 \"$i\""
done

SELECT
	 TO_CHAR(C.BEGIN_INTERVAL_TIME,'YYYY-MM-DD') "DATE"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'00',B.ELAPSED_REDO_WAIT_TIME - A.ELAPSED_REDO_WAIT_TIME))/100 "00"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'01',B.ELAPSED_REDO_WAIT_TIME - A.ELAPSED_REDO_WAIT_TIME))/100 "01"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'02',B.ELAPSED_REDO_WAIT_TIME - A.ELAPSED_REDO_WAIT_TIME))/100 "02"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'03',B.ELAPSED_REDO_WAIT_TIME - A.ELAPSED_REDO_WAIT_TIME))/100 "03"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'04',B.ELAPSED_REDO_WAIT_TIME - A.ELAPSED_REDO_WAIT_TIME))/100 "04"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'05',B.ELAPSED_REDO_WAIT_TIME - A.ELAPSED_REDO_WAIT_TIME))/100 "05"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'06',B.ELAPSED_REDO_WAIT_TIME - A.ELAPSED_REDO_WAIT_TIME))/100 "06"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'07',B.ELAPSED_REDO_WAIT_TIME - A.ELAPSED_REDO_WAIT_TIME))/100 "07"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'08',B.ELAPSED_REDO_WAIT_TIME - A.ELAPSED_REDO_WAIT_TIME))/100 "08"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'09',B.ELAPSED_REDO_WAIT_TIME - A.ELAPSED_REDO_WAIT_TIME))/100 "09"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'10',B.ELAPSED_REDO_WAIT_TIME - A.ELAPSED_REDO_WAIT_TIME))/100 "10"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'11',B.ELAPSED_REDO_WAIT_TIME - A.ELAPSED_REDO_WAIT_TIME))/100 "11"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'12',B.ELAPSED_REDO_WAIT_TIME - A.ELAPSED_REDO_WAIT_TIME))/100 "12"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'13',B.ELAPSED_REDO_WAIT_TIME - A.ELAPSED_REDO_WAIT_TIME))/100 "13"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'14',B.ELAPSED_REDO_WAIT_TIME - A.ELAPSED_REDO_WAIT_TIME))/100 "14"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'15',B.ELAPSED_REDO_WAIT_TIME - A.ELAPSED_REDO_WAIT_TIME))/100 "15"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'16',B.ELAPSED_REDO_WAIT_TIME - A.ELAPSED_REDO_WAIT_TIME))/100 "16"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'17',B.ELAPSED_REDO_WAIT_TIME - A.ELAPSED_REDO_WAIT_TIME))/100 "17"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'18',B.ELAPSED_REDO_WAIT_TIME - A.ELAPSED_REDO_WAIT_TIME))/100 "18"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'19',B.ELAPSED_REDO_WAIT_TIME - A.ELAPSED_REDO_WAIT_TIME))/100 "19"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'20',B.ELAPSED_REDO_WAIT_TIME - A.ELAPSED_REDO_WAIT_TIME))/100 "20"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'21',B.ELAPSED_REDO_WAIT_TIME - A.ELAPSED_REDO_WAIT_TIME))/100 "21"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'22',B.ELAPSED_REDO_WAIT_TIME - A.ELAPSED_REDO_WAIT_TIME))/100 "22"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'23',B.ELAPSED_REDO_WAIT_TIME - A.ELAPSED_REDO_WAIT_TIME))/100 "23"
FROM
	DBA_HIST_STREAMS_CAPTURE A, 
	DBA_HIST_STREAMS_CAPTURE B,
	DBA_HIST_SNAPSHOT C
WHERE 
	    B.SNAP_ID = A.SNAP_ID+1
	AND B.INSTANCE_NUMBER = A.INSTANCE_NUMBER
	AND B.SNAP_ID=C.SNAP_ID 
	AND B.INSTANCE_NUMBER = C.INSTANCE_NUMBER
GROUP BY
	TO_CHAR(C.BEGIN_INTERVAL_TIME,'YYYY-MM-DD')
ORDER BY
	1
;


SELECT
	 TO_CHAR(C.BEGIN_INTERVAL_TIME,'YYYY-MM-DD') "DATE"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'00',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "00"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'01',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "01"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'02',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "02"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'03',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "03"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'04',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "04"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'05',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "05"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'06',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "06"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'07',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "07"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'08',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "08"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'09',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "09"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'10',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "10"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'11',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "11"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'12',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "12"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'13',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "13"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'14',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "14"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'15',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "15"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'16',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "16"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'17',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "17"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'18',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "18"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'19',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "19"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'20',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "20"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'21',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "21"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'22',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "22"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'23',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "23"
FROM
	DBA_HIST_STREAMS_CAPTURE A, 
	DBA_HIST_STREAMS_CAPTURE B,
	DBA_HIST_SNAPSHOT C
WHERE 
	    B.SNAP_ID = A.SNAP_ID+1
	AND B.INSTANCE_NUMBER = A.INSTANCE_NUMBER
	AND B.SNAP_ID=C.SNAP_ID 
	AND B.INSTANCE_NUMBER = C.INSTANCE_NUMBER
GROUP BY
	TO_CHAR(C.BEGIN_INTERVAL_TIME,'YYYY-MM-DD')
ORDER BY
	1
;


SELECT
	 TO_CHAR(C.BEGIN_INTERVAL_TIME,'YYYY-MM-DD') "DATE"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'00',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "00"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'01',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "01"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'02',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "02"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'03',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "03"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'04',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "04"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'05',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "05"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'06',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "06"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'07',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "07"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'08',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "08"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'09',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "09"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'10',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "10"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'11',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "11"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'12',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "12"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'13',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "13"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'14',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "14"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'15',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "15"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'16',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "16"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'17',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "17"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'18',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "18"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'19',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "19"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'20',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "20"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'21',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "21"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'22',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "22"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'23',B.ELAPSED_PAUSE_TIME - A.ELAPSED_PAUSE_TIME))/100 "23"
FROM
	DBA_HIST_STREAMS_CAPTURE A, 
	DBA_HIST_STREAMS_CAPTURE B,
	DBA_HIST_SNAPSHOT C
WHERE 
	    B.SNAP_ID = A.SNAP_ID+1
	AND B.INSTANCE_NUMBER = A.INSTANCE_NUMBER
	AND B.SNAP_ID=C.SNAP_ID 
	AND B.INSTANCE_NUMBER = C.INSTANCE_NUMBER
GROUP BY
	TO_CHAR(C.BEGIN_INTERVAL_TIME,'YYYY-MM-DD')
ORDER BY
	1
;


05-DEC-13 01.40.48.467

set numformat 99999
SELECT 
	TO_CHAR(SAMPLE_TIME,'YYYY-MM-DD') "DATE"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'00',1)) "00"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'01',1)) "01"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'02',1)) "02"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'03',1)) "03"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'04',1)) "04"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'05',1)) "05"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'06',1)) "06"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'07',1)) "07"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'08',1)) "08"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'09',1)) "09"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'10',1)) "10"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'11',1)) "11"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'12',1)) "12"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'13',1)) "13"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'14',1)) "14"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'15',1)) "15"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'16',1)) "16"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'17',1)) "17"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'18',1)) "18"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'19',1)) "19"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'20',1)) "20"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'21',1)) "21"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'22',1)) "22"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'23',1)) "23"
FROM 
	DBA_HIST_ACTIVE_SESS_HISTORY
WHERE
		SESSION_ID IN (1620,1721,1900,2033)
	AND SESSION_STATE = 'ON CPU'
--	AND SNAP_ID=51195
--    AND SAMPLE_TIME BETWEEN 
--        TO_TIMESTAMP('2013-12-05 13:40:48','YYYY-MM-DD HH24:MI:SS') AND 
--        TO_TIMESTAMP('2013-12-05 13:40:59','YYYY-MM-DD HH24:MI:SS')
GROUP BY 
	TO_CHAR(SAMPLE_TIME,'YYYY-MM-DD')
ORDER BY 1
;



DATE           00     01     02     03     04     05     06     07     08     09     10     11     12     13     14     15     16     17     18     19     20     21     22     23
---------- ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------
2013-11-10      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0     67     55
2013-11-11     42     43     40     36     55    149    151    140    101    126    112    168     64     77     85     52     49     58     71     62     76     68     71    123
2013-11-12     54     40     56     73     45     42     66     52    146     62     71     68    207    154    143     89    130     71     31     41     48     41     54     46
2013-11-13     38    141     56     56     48     48     52     65    119    181    161    133    120    105     65     56     66     75     93     65     70     55     41     57
2013-11-14     51     69     92     91     58     46     42     58    114    209    160    151    137     70     82     76     51     72     70     60     54     60     53     47
2013-11-15     53     42     48     65    151     81     63     76    185     51     61     66     66     57     53     75     73     77     59     42     78    180    121    107
2013-11-16    110     80     66     34     55     52     43     49     49     68     62    107    138     62     63     78     70     58     63     63     75     74     73     56
2013-11-17     38     46     38     32     35     40     56     41     60     62     59     68     64     75     66     78     49     75     81     77     60     49     77     53
2013-11-18     70     83    101    119    159    148    111    117    134    108    114    122    119     86    141     89     64     70     69     57     62     69     85     75
2013-11-19     49     53     36     51    105     98     70     99    172    139    124    127    118    124    119     83    131     98     95     96    137     73     46     49
2013-11-20     68     48     44     67     68     55     79    207    154    157    239    259    115    123     97    110    128    116    109    121    112     55     51     57
2013-11-21     42     41     41     57     61     60     99    153    181    143    193    127    135    111     91    137    108     52     64     46     67     59     45     44
2013-11-22     52     33     50     61     59     55     46     60     72     61     59     66    165     70     64     71     56     43     53     71     55     95    252    151
2013-11-23    108     90     97     71    114     89    123    110    112     93    113     58     68     63     61     56    137     63     60     59     66     71     58     56
2013-11-24     58     57     41     31     48     39     63     58     74     69     74     71     56     65     74     61     55     86     57     61     40     78     63     50
2013-11-25     53     57     41     49     36     78    175    157    111    123     86     61     67     61    106     75     57    101     57     61     59     68    124     79
2013-11-26     48    123     54     46     43     79     50     78     59     71     68     92    176     61     62     69     82     68     56     54     58     44     56     44
2013-11-27    175     87    141    199    146    106    155    189    119    139     72    105    148     87     67     68     73     60     70     66     61     68     84     66
2013-11-28    131     61     39     45     48     60     44     56    148    184    129    104    109     82     53     64     47     49     59     67     53     64     87    173
2013-11-29     40     57     48     45     51     48     55     56     69     65     67     67     76     61     86     62     98     78    150    136    134    109    123     77
2013-11-30    103     37     47     45     53     55     48     57     58     57     83     73     74     58     77     57     64     64     61     68     54     66     61     49
2013-12-01     44     53     48     28     46     53     88     73     54     84     67     58     58     78     72     77     52     78     63     67     56     52     66     61
2013-12-02     59     64     41     89    165    160    116    108     52     59     88     74     61     78     57     86     71     65     67     56     75     70     64     48
2013-12-03     52     37     55     39     59     65     61     81    178    179    113    113    130     59     74     61     74     61     96     59     49     55     53     59
2013-12-04     49     41     49     68     70     67     60    188    194    117    149    380    385    382    390    385    240     68     69     64     62     49     56     48
2013-12-05     39     43     48     55     81     72     77     78     59    105    176    284    388    403    408    385    387    398    408    292     70     52     56     62
2013-12-06     54     58    103     72     44     52     62     71     71     69     74     71     73    367    373    382    401     86     92    192    149    127    113    108
2013-12-07     51     49     35     48    116     69     49     54     76    158     78     69     86    129    174     87     62     60     40     63     58     46    167     52
2013-12-08     53     35     62     38     52     37     49    119     74     67     89     96     69     74     59     68     63     60    121     53     48     72     69     52
2013-12-09     61     44     45     47     66     59     49     59     65     68     69     55     98    150     80     74     55     50     62     67     48     61     67     55
2013-12-10     59     35     53     60     52     47     49     55     55     67     75     65    183    176    213    125    131     71     67     70     56     49     46     54
2013-12-11     45     68     57     45     57     61    142    161    154    116    125    134     92     66     50     70     43      0      0      0      0      0      0      0



set numformat 99999
SELECT 
	TO_CHAR(SAMPLE_TIME,'YYYY-MM-DD') "DATE"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'00',1)) "00"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'01',1)) "01"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'02',1)) "02"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'03',1)) "03"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'04',1)) "04"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'05',1)) "05"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'06',1)) "06"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'07',1)) "07"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'08',1)) "08"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'09',1)) "09"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'10',1)) "10"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'11',1)) "11"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'12',1)) "12"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'13',1)) "13"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'14',1)) "14"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'15',1)) "15"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'16',1)) "16"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'17',1)) "17"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'18',1)) "18"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'19',1)) "19"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'20',1)) "20"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'21',1)) "21"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'22',1)) "22"
	,COUNT(DECODE(TO_CHAR(SAMPLE_TIME,'HH24'),'23',1)) "23"
FROM 
	DBA_HIST_ACTIVE_SESS_HISTORY
WHERE
		SESSION_ID IN (1620,1721,1900,2033)
	AND SESSION_STATE = 'WAITING'
--	AND SNAP_ID=51195
--    AND SAMPLE_TIME BETWEEN 
--        TO_TIMESTAMP('2013-12-05 13:40:48','YYYY-MM-DD HH24:MI:SS') AND 
--        TO_TIMESTAMP('2013-12-05 13:40:59','YYYY-MM-DD HH24:MI:SS')
GROUP BY 
	TO_CHAR(SAMPLE_TIME,'YYYY-MM-DD')
ORDER BY 1
;

DATE           00     01     02     03     04     05     06     07     08     09     10     11     12     13     14     15     16     17     18     19     20     21     22     23
---------- ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------ ------
2013-11-10      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0      0    240    255
2013-11-11    265    272    280    266    256    234    227    241    247    232    247    221    283    257    272    265    254    276    252    258    239    263    278    225
2013-11-12    254    263    269    250    254    266    261    258    222    268    261    262    193    231    238    268    237    247    293    291    258    259    270    258
2013-11-13    274    229    252    263    244    277    283    270    217    210    229    244    257    248    259    271    262    262    264    276    259    284    267    257
2013-11-14    264    255    239    244    257    263    279    285    242    205    223    225    235    273    268    274    273    266    273    278    278    266    277    254
2013-11-15    260    265    277    258    211    252    276    280    200    274    264    270    271    280    279    268    270    248    268    291    276    216    242    252
2013-11-16    255    246    260    286    265    251    267    280    261    258    261    237    229    267    262    261    251    270    251    274    247    231    246    249
2013-11-17    246    276    255    273    262    266    261    273    265    246    274    255    260    265    242    243    265    242    234    279    275    275    245    267
2013-11-18    264    265    238    228    218    235    265    261    266    265    270    272    274    270    266    293    280    256    252    263    234    247    265    257
2013-11-19    266    263    278    264    231    239    283    244    216    239    245    265    291    266    269    279    252    278    256    277    271    253    260    263
2013-11-20    246    264    265    244    247    250    246    209    236    132     13     11    256    260    268    273    271    282    267    239    272    276    264    255
2013-11-21    276    259    253    260    264    260    246    210    218    243    205    248    257    265    266    262    261    264    270    269    255    268    283    289
2013-11-22    263    280    278    248    251    269    287    259    242    279    277    265    214    281    268    279    284    278    276    242    260    243    178    219
2013-11-23    227    255    281    279    267    273    271    252    253    261    267    267    275    272    266    274    235    257    275    260    271    235    270    254
2013-11-24    273    258    269    294    268    264    254    257    254    264    254    263    272    262    259    271    243    271    271    265    282    265    239    272
2013-11-25    259    265    259    278    271    249    224    219    235    249    254    276    292    283    243    273    275    238    260    267    276    258    256    244
2013-11-26    272    221    239    274    262    244    264    255    261    262    276    245    207    265    266    264    276    261    261    267    278    269    243    248
2013-11-27     68      6    209    207    229    239    250    219    245    235    243    243    228    248    249    267    268    274    259    273    262    232    242    250
2013-11-28    217    258    242    261    247    249    280    274    219    214    240    255    256    249    289    265    271    265    261    275    265    290    255    209
2013-11-29    261    281    257    266    255    238    266    268    258    257    257    265    254    255    247    256    255    256    232    238    243    241    243    253
2013-11-30    253    259    273    271    268    265    280    264    276    264    261    262    278    262    265    278    276    264    262    263    263    259    262    247
2013-12-01    260    278    259    279    277    257    248    264    273    269    248    256    255    261    247    243    262    262    253    269    278    268    244    251
2013-12-02    256    252    265    253    205    226    250    244    272    267    260    260    255    263    258    246    257    262    243    259    251    257    260    267
2013-12-03    260    266    266    254    245    241    272    251    200    224    250    248    247    273    283    290    256    273    245    280    272    260    265    255
2013-12-04    263    281    258    261    254    245    264    202    199    247    208      4      2      5      1      0    124    289    265    270    257    263    233    271
2013-12-05    292    268    265    243    226    258    261    261    282    239    214    107      0      9      0      5      6      0      2    106    266    272    266    254
2013-12-06    280    254    231    258    276    265    284    260    276    265    276    248    272     12      0      1      0    272    256    204    232    252    249    247
2013-12-07    280    269    260    267    252    266    286    275    267    226    276    277    267    236    200    258    274    263    277    254    278    271    204    265
2013-12-08    271    274    252    260    259    263    273    232    269    269    258    238    268    255    263    266    275    263    231    274    279    265    267    269
2013-12-09    269    275    275    282    260    263    277    266    261    257    265    277    269    230    275    260    270    282    282    278    284    263    271    270
2013-12-10    265    279    253    272    276    276    275    281    277    263    254    270    201    216    214    243    237    263    268    256    265    261    283    264
2013-12-11    268    247    270    270    248    260    222    233    263    279    259    252    250    266    283    252    201      0      0      0      0      0      0      0


Wed Nov  6 19:37:07 2013
Streams CAPTURE C001 started with pid=133, OS id=31559
Wed Nov  6 19:38:00 2013
LOGMINER: Parameters summary for session# = 1
LOGMINER: Number of processes = 3, Transaction Chunk Size = 1
LOGMINER: Memory Size = 128M, Checkpoint interval = 1000M
LOGMINER: session# = 1, preparer process P007 started with pid=608 OS id=21283
LOGMINER: session# = 1, reader process P005 started with pid=299 OS id=21279
LOGMINER: session# = 1, builder process P006 started with pid=607 OS id=21281


select * from v$session where paddr in (
select addr from v$process where spid in (31559,21283,21279,21281)
);


set lin 400 pages 400
set trimspool on
col sample_time format a30
col instance_number format a2
col event format a30
col username format a11
col program format a30 trunc
col BLOCKING_INST_ID format 9
col seconds format 9999990.9999
BREAK ON SAMPLE_TIME SKIP page
compute count of session_id on sample_time
SELECT
      A.SAMPLE_TIME
	 ,a.SNAP_ID
     ,to_char(A.INSTANCE_NUMBER) INSTANCE_NUMBER
     ,A.SESSION_ID
     ,A.EVENT
     ,A.SEQ#
     ,A.SESSION_STATE
     ,(A.WAIT_TIME + A.TIME_WAITED)/1000000 SECONDS
     --A.DELTA_TIME/1000000 DELTA_SECS
     ,A.SQL_ID
     ,A.SQL_PLAN_HASH_VALUE
     ,A.CURRENT_OBJ#
	 --,A.BLOCKING_INST_ID
     ,A.BLOCKING_SESSION
     ,A.BLOCKING_SESSION_STATUS
     --,to_char(A.BLOCKING_INST_ID) BLOCKING_INST_ID
     --,A.PROGRAM
     --,A.PLSQL_ENTRY_OBJECT_ID
     --,A.PLSQL_ENTRY_SUBPROGRAM_ID
FROM
     DBA_HIST_ACTIVE_SESS_HISTORY A
WHERE
	 SESSION_ID IN (1620,1721,1900,2033) AND
     SAMPLE_TIME BETWEEN 
        TO_TIMESTAMP('2013-12-05 13:00:00','YYYY-MM-DD HH24:MI:SS') AND 
        TO_TIMESTAMP('2013-12-05 14:00:00','YYYY-MM-DD HH24:MI:SS')
ORDER BY SAMPLE_TIME, session_id;


set numformat 999999 lin 400 pages 200
SELECT
	 TO_CHAR(C.BEGIN_INTERVAL_TIME,'YYYY-MM-DD') "DATE"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'00',B.SERVER_TOTAL_MESSAGES_APPLIED - A.SERVER_TOTAL_MESSAGES_APPLIED))/60 "00"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'01',B.SERVER_TOTAL_MESSAGES_APPLIED - A.SERVER_TOTAL_MESSAGES_APPLIED))/60 "01"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'02',B.SERVER_TOTAL_MESSAGES_APPLIED - A.SERVER_TOTAL_MESSAGES_APPLIED))/60 "02"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'03',B.SERVER_TOTAL_MESSAGES_APPLIED - A.SERVER_TOTAL_MESSAGES_APPLIED))/60 "03"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'04',B.SERVER_TOTAL_MESSAGES_APPLIED - A.SERVER_TOTAL_MESSAGES_APPLIED))/60 "04"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'05',B.SERVER_TOTAL_MESSAGES_APPLIED - A.SERVER_TOTAL_MESSAGES_APPLIED))/60 "05"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'06',B.SERVER_TOTAL_MESSAGES_APPLIED - A.SERVER_TOTAL_MESSAGES_APPLIED))/60 "06"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'07',B.SERVER_TOTAL_MESSAGES_APPLIED - A.SERVER_TOTAL_MESSAGES_APPLIED))/60 "07"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'08',B.SERVER_TOTAL_MESSAGES_APPLIED - A.SERVER_TOTAL_MESSAGES_APPLIED))/60 "08"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'09',B.SERVER_TOTAL_MESSAGES_APPLIED - A.SERVER_TOTAL_MESSAGES_APPLIED))/60 "09"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'10',B.SERVER_TOTAL_MESSAGES_APPLIED - A.SERVER_TOTAL_MESSAGES_APPLIED))/60 "10"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'11',B.SERVER_TOTAL_MESSAGES_APPLIED - A.SERVER_TOTAL_MESSAGES_APPLIED))/60 "11"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'12',B.SERVER_TOTAL_MESSAGES_APPLIED - A.SERVER_TOTAL_MESSAGES_APPLIED))/60 "12"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'13',B.SERVER_TOTAL_MESSAGES_APPLIED - A.SERVER_TOTAL_MESSAGES_APPLIED))/60 "13"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'14',B.SERVER_TOTAL_MESSAGES_APPLIED - A.SERVER_TOTAL_MESSAGES_APPLIED))/60 "14"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'15',B.SERVER_TOTAL_MESSAGES_APPLIED - A.SERVER_TOTAL_MESSAGES_APPLIED))/60 "15"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'16',B.SERVER_TOTAL_MESSAGES_APPLIED - A.SERVER_TOTAL_MESSAGES_APPLIED))/60 "16"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'17',B.SERVER_TOTAL_MESSAGES_APPLIED - A.SERVER_TOTAL_MESSAGES_APPLIED))/60 "17"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'18',B.SERVER_TOTAL_MESSAGES_APPLIED - A.SERVER_TOTAL_MESSAGES_APPLIED))/60 "18"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'19',B.SERVER_TOTAL_MESSAGES_APPLIED - A.SERVER_TOTAL_MESSAGES_APPLIED))/60 "19"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'20',B.SERVER_TOTAL_MESSAGES_APPLIED - A.SERVER_TOTAL_MESSAGES_APPLIED))/60 "20"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'21',B.SERVER_TOTAL_MESSAGES_APPLIED - A.SERVER_TOTAL_MESSAGES_APPLIED))/60 "21"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'22',B.SERVER_TOTAL_MESSAGES_APPLIED - A.SERVER_TOTAL_MESSAGES_APPLIED))/60 "22"
	,SUM(DECODE(TO_CHAR(C.BEGIN_INTERVAL_TIME,'HH24'),'23',B.SERVER_TOTAL_MESSAGES_APPLIED - A.SERVER_TOTAL_MESSAGES_APPLIED))/60 "23"
FROM
	DBA_HIST_STREAMS_APPLY_SUM A, 
	DBA_HIST_STREAMS_APPLY_SUM B,
	DBA_HIST_SNAPSHOT C
WHERE 
	    B.SNAP_ID = A.SNAP_ID+1
	AND B.INSTANCE_NUMBER = A.INSTANCE_NUMBER
	AND B.SNAP_ID=C.SNAP_ID 
	AND B.INSTANCE_NUMBER = C.INSTANCE_NUMBER
GROUP BY
	TO_CHAR(C.BEGIN_INTERVAL_TIME,'YYYY-MM-DD')
ORDER BY
	1
;


for i in {0..23}; do
	if [[ $i -lt 10 ]]; then i=0$i; fi
	echo ",AVG(DECODE(TO_CHAR(B.BEGIN_INTERVAL_TIME,'HH24'),'$i',((A.ALLOCATED_TOTAL/A.NUM_PROCESSES)/1024/1024))) \"$i\""
done


